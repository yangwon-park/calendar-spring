name: PR Automation

on:
  pull_request:
    types: [opened, ready_for_review, closed]

permissions:
  pull-requests: write

jobs:
  pr-setup:
    if: github.event.action == 'opened' || github.event.action == 'ready_for_review'
    runs-on: ubuntu-latest
    steps:
      - name: Auto-assign Author & Reviewers
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          ACTOR: ${{ github.actor }}
          CANDIDATES: "team-member-1 team-member-2"
        run: |
          # -R ${{ github.repository }} 옵션 추가
          gh pr edit $PR_NUMBER -R ${{ github.repository }} --add-assignee "$ACTOR" --add-label "Review Needed"

#          REVIEWERS=""
#          for user in $CANDIDATES; do
#            if [ "$user" != "$ACTOR" ]; then
#              REVIEWERS="$REVIEWERS $user"
#            fi
#          done
#
#          if [ -n "$REVIEWERS" ]; then
#            # 여기도 -R 옵션 추가
#            gh pr edit $PR_NUMBER -R ${{ github.repository }} --add-reviewer "$REVIEWERS"
#          fi

  pr-merged:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Update Labels on Merge
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          # 여기도 -R 옵션 추가
          gh pr edit $PR_NUMBER -R ${{ github.repository }} --add-label "Approved" --remove-label "Review Needed"